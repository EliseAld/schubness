library(Seurat)
library(pbapply)
path <- "/Users/elise/Desktop/GitHub/Hubness_sc/data/forTI/dynverse/1_rds/"
datasets <- sort(c('dyntoy_looping_1.rds', 'silver_planaria-full_plass.rds', 'silver_mouse-cell-atlas-combination-2.rds',
              'dyntoy_linear_2.rds', 'gold_hematopoiesis-gates_olsson.rds', 'silver_planaria-pair-10_plass.rds',
              'gold_psc-astrocyte-maturation-glia_sloan.rds', 'dyntoy_linear_3.rds', 'prosstt_multifurcating_6.rds',
              'silver_mouse-cell-atlas-combination-3.rds', 'dyngen_2.rds', 'silver_planaria-combination-1_plass.rds',
              'gold_germline-human-female-weeks_li.rds', 'dyntoy_looping_2.rds',
              'silver_fetal-liver-fetal-hematopoiesis_mca.rds', 'gold_stimulated-dendritic-cells-LPS_shalek.rds',
              'gold_germline-human-female_guo.rds', 'dyntoy_disconnected_10.rds',
              'silver_mouse-cell-atlas-combination-1.rds', 'dyntoy_binary_tree_7.rds',
              'silver_planaria-combination-13_plass.rds', 'dyntoy_linear_1.rds', 'silver_planaria-pair-7_plass.rds',
              'dyntoy_binary_tree_6.rds', 'dyngen_1.rds', 'silver_hepatoblast-differentiation_yang.rds',
              'splatter_multifurcating_10.rds', 'silver_placenta-trophoblast-differentiation-invasive_mca.rds',
              'dyntoy_looping_3.rds', 'dyntoy_looping_7.rds', 'gold_cell-cycle_buettner.rds',
              'silver_oligodendrocyte-differentiation-subclusters_marques.rds',
              'silver_trophoblast-stem-cell-trophoblast-differentiation_mca.rds',
              'silver_mouse-cell-atlas-combination-4.rds', 'dyntoy_binary_tree_2.rds',
              'silver_distal-lung-epithelium_treutlein.rds', 'dyngen_10.rds',
              'silver_planaria-combination-7_plass.rds', 'silver_trophectoderm-monkey_nakamura.rds',
              'dyntoy_binary_tree_3.rds', 'silver_mouse-cell-atlas-combination-5.rds',
              'silver_epiblast-monkey_nakamura.rds', 'silver_planaria-neuron-differentiation_plass.rds',
              'gold_stimulated-dendritic-cells-PAM_shalek.rds', 'silver_epidermis-hair-spatial_joost.rds',
              'dyntoy_looping_6.rds', 'silver_olfactory-projection-neurons_horns.rds',
              'silver_mouse-cell-atlas-combination-7.rds', 'dyntoy_binary_tree_1.rds', 'dyntoy_linear_7.rds',
              'silver_oligodendrocyte-differentiation-clusters_marques.rds', 'dyngen_12.rds', 'dyntoy_linear_6.rds',
              'prosstt_multifurcating_3.rds', 'silver_mouse-cell-atlas-combination-6.rds',
              'silver_planaria-pair-1_plass.rds', 'dyntoy_bifurcating_10.rds',
              'silver_bone-marrow-mesenchyme-erythrocyte-differentiation_mca.rds',
              'gold_mESC-differentiation_hayashi.rds', 'gold_developing-dendritic-cells_schlitzer.rds',
              'silver_planaria-parenchyme-differentiation_plass.rds', 'dyntoy_diverging_converging_10.rds',
              'dyntoy_multifurcating_10.rds', 'dyngen_61.rds', 'prosstt_bifurcating_1.rds', 'dyngen_60.rds',
              'dyngen_110.rds', 'dyntoy_linear_10.rds', 'silver_germline-human-female_li.rds',
              'silver_cell-cycle_leng.rds', 'prosstt_tree_1.rds', 'silver_planaria-pair-11_plass.rds',
              'prosstt_linear_6.rds', 'splatter_bifurcating_7.rds', 'splatter_bifurcating_5.rds',
              'dyntoy_converging_6.rds', 'splatter_bifurcating_10.rds', 'dyntoy_tree_10.rds',
              'silver_planaria-combination-12_plass.rds', 'silver_planaria-pair-6_plass.rds',
              'dyntoy_converging_10.rds', 'prosstt_tree_3.rds', 'dyntoy_cyclic_7.rds', 'dyngen_62.rds',
              'gold_germline-human-male-weeks_li.rds', 'prosstt_bifurcating_2.rds', 'prosstt_bifurcating_3.rds',
              'silver_olfactory-projection-neurons-DA1_horns.rds', 'dyntoy_cyclic_6.rds', 'dyntoy_converging_7.rds',
              'splatter_bifurcating_4.rds', 'dyntoy_converging_3.rds', 'silver_planaria-combination-6_plass.rds',
              'prosstt_linear_1.rds', 'prosstt_tree_6.rds', 'silver_thymus-t-cell-differentiation_mca.rds',
              'dyntoy_cyclic_2.rds', 'prosstt_bifurcating_7.rds', 'prosstt_bifurcating_6.rds', 'dyntoy_cyclic_3.rds',
              'dyngen_72.rds', 'dyngen_102.rds', 'splatter_binary_tree_10.rds', 'dyntoy_converging_2.rds',
              'dyntoy_looping_10.rds', 'dyntoy_connected_10.rds', 'splatter_bifurcating_1.rds',
              'gold_pancreatic-beta-cell-maturation_zhang.rds', 'splatter_bifurcating_3.rds',
              'gold_cellbench-SC1_luyitian.rds', 'splatter_tree_10.rds', 'dyngen_70.rds', 'dyngen_100.rds',
              'dyntoy_cyclic_1.rds', 'prosstt_bifurcating_4.rds', 'silver_planaria-combination-14_plass.rds',
              'prosstt_bifurcating_5.rds', 'dyngen_65.rds', 'dyngen_101.rds', 'dyngen_71.rds',
              'dyntoy_binary_tree_10.rds', 'prosstt_linear_3.rds', 'dyntoy_converging_1.rds',
              'gold_stimulated-dendritic-cells-PIC_shalek.rds', 'splatter_bifurcating_2.rds',
              'gold_human-embryos_petropoulos.rds', 'silver_ICM-monkey_nakamura.rds',
              'silver_germline-human-male_li.rds', 'silver_planaria-pair-12_plass.rds',
              'dyntoy_diverging_with_loops_1.rds', 'silver_neonatal-inner-ear-SC-HC_burns.rds',
              'silver_planaria-combination-3_plass.rds', 'prosstt_binary_tree_1.rds', 'dyntoy_multifurcating_3.rds',
              'dyntoy_tree_2.rds', 'dyngen_40.rds', 'prosstt_bifurcating_8.rds', 'dyngen_82.rds', 'dyntoy_tree_3.rds',
              'dyntoy_multifurcating_2.rds', 'dyntoy_cyclic_10.rds', 'silver_kidney-collecting-duct-clusters_park.rds',
              'splatter_binary_tree_7.rds', 'silver_neonatal-inner-ear-all_burns.rds', 'silver_planaria-pair-8_plass.rds',
              'splatter_binary_tree_5.rds', 'dyntoy_diverging_with_loops_2.rds',
              'silver_planaria-epidermis-differentiation_plass.rds', 'gold_cellbench-SC3_luyitian.rds',
              'silver_kidney-distal-convoluted-tubule_mca.rds', 'dyntoy_tree_1.rds', 'gold_cellbench-SC4_luyitian.rds',
              'silver_epidermis-hair-uHF_joost.rds', 'dyngen_80.rds', 'dyngen_95.rds', 'dyngen_42.rds',
              'prosstt_binary_tree_3.rds', 'silver_neonatal-rib-cartilage_mca.rds',
              'gold_macrophage-salmonella_saliba.rds', 'silver_fibroblast-reprogramming_treutlein.rds',
              'silver_hematopoiesis-clusters_olsson.rds', 'silver_planaria-pharynx-differentiation_plass.rds',
              'silver_olfactory-projection-neurons-DC3_VA1d_horns.rds', 'dyntoy_diverging_with_loops_3.rds',
              'silver_planaria-pair-5_plass.rds', 'splatter_binary_tree_4.rds', 'silver_planaria-combination-11_plass.rds',
              'dyntoy_diverging_with_loops_7.rds', 'silver_blastocyst-monkey_nakamura.rds', 'dyngen_52.rds', 'dyngen_91.rds',
              'dyngen_90.rds', 'prosstt_binary_tree_6.rds', 'silver_dentate-gyrus-neurogenesis_hochgerner.rds',
              'silver_planaria-pair-14_plass.rds', 'silver_planaria-muscle-differentiation_plass.rds',
              'dyntoy_diverging_with_loops_6.rds', 'splatter_binary_tree_1.rds',
              'silver_embryonic-mesenchyme-stromal-cell-cxcl14-cxcl12-axis_mca.rds',
              'silver_planaria-combination-5_plass.rds', 'gold_mesoderm-development_loh.rds',
              'splatter_binary_tree_3.rds', 'silver_planaria-pair-3_plass.rds', 'dyntoy_multifurcating_6.rds',
              'dyntoy_tree_7.rds', 'dyngen_92.rds', 'dyntoy_tree_6.rds', 'dyntoy_multifurcating_7.rds', 'dyngen_50.rds',
              'silver_kidney-collecting-duct-subclusters_park.rds', 'silver_kidney-bursh-border-to-s1_mca.rds',
              'splatter_binary_tree_2.rds', 'silver_planaria-combination-8_plass.rds', 'gold_cellbench-SC2_luyitian.rds',
              'silver_planaria-combination-2_plass.rds', 'splatter_tree_7.rds', 'dyntoy_diverging_with_loops_10.rds',
              'silver_mouse-cell-atlas-combination-10.rds', 'silver_planaria-pair-13_plass.rds', 'splatter_linear_5.rds',
              'silver_neonatal-inner-ear-TEC-SC_burns.rds', 'dyngen_22.rds', 'splatter_linear_4.rds',
              'silver_cortical-interneuron-differentiation_frazer.rds', 'gold_germline-human-male_guo.rds',
              'silver_planaria-pair-9_plass.rds', 'gold_germline-human-both_guo.rds', 'splatter_multifurcating_1.rds',
              'splatter_multifurcating_3.rds', 'dyntoy_diverging_converging_6.rds', 'splatter_tree_4.rds',
              'silver_epidermis-hair-IFE_joost.rds', 'dyntoy_bifurcating_7.rds', 'gold_myoblast-differentiation_trapnell.rds',
              'silver_mouse-cell-atlas-combination-8.rds', 'dyntoy_disconnected_7.rds', 'dyngen_20.rds', 'dyntoy_connected_7.rds',
              'dyntoy_connected_6.rds', 'silver_mammary-gland-involution-endothelial-cell-aqp1-gradient_mca.rds',
              'dyntoy_disconnected_6.rds', 'splatter_linear_7.rds', 'silver_planaria-pair-4_plass.rds', 'dyntoy_bifurcating_6.rds',
              'silver_planaria-combination-10_plass.rds', 'splatter_tree_5.rds', 'dyntoy_diverging_converging_7.rds',
              'silver_placenta-trophoblast-differentiation_mca.rds', 'splatter_multifurcating_2.rds',
              'gold_pancreatic-alpha-cell-maturation_zhang.rds', 'dyntoy_diverging_converging_3.rds', 'splatter_tree_1.rds',
              'dyntoy_bifurcating_2.rds', 'splatter_linear_3.rds', 'splatter_linear_10.rds', 'dyngen_31.rds',
              'dyntoy_disconnected_2.rds', 'dyntoy_connected_2.rds', 'dyntoy_connected_3.rds', 'dyntoy_disconnected_3.rds',
              'dyngen_30.rds', 'splatter_linear_2.rds', 'silver_planaria-combination-4_plass.rds', 'dyntoy_bifurcating_3.rds',
              'silver_embronic-mesenchyme-neuron-differentiation_mca.rds', 'dyntoy_diverging_converging_2.rds',
              'splatter_multifurcating_7.rds', 'gold_NKT-differentiation_engel.rds', 'silver_planaria-pair-2_plass.rds',
              'splatter_multifurcating_5.rds', 'splatter_tree_2.rds', 'dyntoy_bifurcating_1.rds',
              'silver_planaria-phagocyte-differentiation_plass.rds', 'dyngen_32.rds', 'dyntoy_disconnected_1.rds',
              'dyntoy_connected_1.rds', 'splatter_linear_1.rds', 'silver_planaria-combination-9_plass.rds',
              'silver_neonatal-inner-ear-TEC-HSC_burns.rds', 'gold_psc-astrocyte-maturation-neuron_sloan.rds',
              'splatter_tree_3.rds', 'dyntoy_diverging_converging_1.rds', 'splatter_multifurcating_4.rds'))
dataset <- datasets[251:263]
dataRDS <- pblapply(dataset,
                    function(x) readRDS(paste0(path,x)))
dataRDS <- lapply(dataRDS,
                  function(x) {tmp1=data.frame(x$prior_information$groups_id);
                  rownames(tmp1)<-tmp1$cell_id;
                  tmp1<-tmp1[x$cell_ids,];
                  tmp2=x$counts;
                  return(list("counts"=tmp2,"groups_id"=tmp1))})
pblapply(seq(length(dataRDS)),
         function(x) saveRDS(dataRDS[[x]], file = paste0(path,dataset[x])))
rm(dataRDS)


