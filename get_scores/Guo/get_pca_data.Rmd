---
title: "PCA obj"
output: html_document
---

```{r libs & paths}
library(Seurat)
data_in <- "/Users/elise/Desktop/Thèse/scRNAseq/Data_sc/Guo_lung_2018/GSE99254_NSCLC.TCell.S9055.count.labeled.txt"
data_out <- "/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/GSE99254_NSCLC.TCell.S9055.count.labeled.pca.txt"
```

```{r do PCA}
data <- read.table(data_in) # 23370 x 9055
seurat <- CreateSeuratObject(data)
seurat[["percent.mt"]] <- PercentageFeatureSet(seurat, pattern = "^MT-")
VlnPlot(seurat, features = c("nFeature_RNA","nCount_RNA","percent.mt"))
FeatureScatter(seurat, feature1 = "nFeature_RNA", feature2 = "nCount_RNA")
# Remove cells with more than 7500 genes or 5e+06 total counts
seurat <- subset(seurat, subset = nFeature_RNA<7500 & nCount_RNA<5e+06) # 9048 cells
# Normalize + log transfo + scale
seurat <- NormalizeData(seurat)
seurat <- ScaleData(seurat)
data <- GetAssayData(seurat)
# PCA
pca <- prcomp(data)
data_proj <- t(pca$rotation) # 9048 PCs x 9048 cells
write.table(data_proj, file=data_out)
```