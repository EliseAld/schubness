GSE100866_pca_readyforhubness <- read.csv("~/Desktop/Imagine_bckp/scRNAseq/Data_sc/hubness_data/10X/GSE100866_pca_readyforhubness.csv", sep="")
View(GSE100866_pca_readyforhubness)
data <- GSE100866_pca_readyforhubness
data <- data[,1:100]
# Range of k values
k.val <- c(5,50,100,200)
# Range of p values for Lp norm
p.val <- c(0.1,0.5,1,1.5,2,4,10)
k.val=c(5,10)
p.val =c(0.1,0.5)
pc.val=2
mat <- t(data)
p=0.1
dist.matrix <- philentropy::distance(mat,method="minkowski",p)
View(dist.matrix)
dist.matrix[diag(dist.matrix)] <- NA # make the matrix upper triangular
View(dist.matrix)
diag(dist.matrix)
diag(dist.matrix) <- NA # make the matrix upper triangular
View(dist.matrix)
k.nn <- t(apply(dist.matrix,1,function(x) order(x,na.last=T)[1:k]))
k=5
k.nn <- t(apply(dist.matrix,1,function(x) order(x,na.last=T)[1:k]))
occurence <- sapply(X=1:nrow(k.nn), FUN=function(x,y) {sum(y==x)}, y=k.nn)
names(occurence) <- colnames(data)
dist.matrix[diag(dist.matrix)] <- NA # make the matrix upper triangular
k.nn <- t(apply(dist.matrix,1,function(x) order(x,na.last=T)[1:k]))
occurence <- sapply(X=1:nrow(k.nn), FUN=function(x,y) {sum(y==x)}, y=k.nn)
diag(dist.matrix) <- NA # remove diag
dist.matrix <- philentropy::distance(mat,method="minkowski",p)
diag(dist.matrix) <- NA # remove diag
k.nn <- t(apply(dist.matrix,1,function(x) order(x,na.last=T)[1:k]))
occu2<- sapply(X=1:nrow(k.nn), FUN=function(x,y) {sum(y==x)}, y=k.nn)
plot(occu2,occurence)
all(occu2=occurence)
all(occu2==occurence)
data <- GSE100866_pca_readyforhubness[,1:500]
dist.matrix <- philentropy::distance(mat,method="minkowski",p)
mat <- t(data)
dist.matrix <- philentropy::distance(mat,method="minkowski",p)
diag(dist.matrix) <- NA # remove diag
k.nn <- t(apply(dist.matrix,1,function(x) order(x,na.last=T)[1:k]))
occurence <- sapply(X=1:nrow(k.nn), FUN=function(x,y) {sum(y==x)}, y=k.nn)
dist.matrix[lower.tri(dist.matrix, diag=T)] <- NA # make the matrix upper triangular
k.nn <- t(apply(dist.matrix,1,function(x) order(x,na.last=T)[1:k]))
occurence2 <- sapply(X=1:nrow(k.nn), FUN=function(x,y) {sum(y==x)}, y=k.nn)
all(occurence==occurence2)
rm(GSE100866_pca_readyforhubness)
rm(dist.matrix)
rm(k.nn)
rm(k,k.val,occu2,occurence)
rm(occurence2)
rm(mat)
rm(p,p.val,pc.val)
data_in <- "/Users/elise/Desktop/Thèse/scRNAseq/Data_sc/Guo_lung_2018/GSE99254_NSCLC.TCell.S9055.count.labeled.txt"
data_out <- "/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/GSE99254_NSCLC.TCell.S9055.count.labeled.pca_readyforhubness.txt"
data_out <- "/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/GSE99254_NSCLC.TCell.S9055.count.labeled.pca_readyforhubness.txt"
data <- read.table(data_in) # 23370 x 9055
seurat <- CreateSeuratObject(data)
library(Seurat)
seurat <- CreateSeuratObject(data)
seurat[["percent.mt"]] <- PercentageFeatureSet(seurat, pattern = "^MT-")
VlnPlot(seurat, features = c("nFeature_RNA","nCount_RNA","percent.mt"))
FeatureScatter(seurat, feature1 = "nFeature_RNA", feature2 = "nCount_RNA")
FeatureScatter(seurat, feature1 = "nFeature_RNA", feature2 = "nCount_RNA") +
geom_vline(xintercept=7500) +
geom_hline(yintercept=5e+06)
library(ggplot2)
FeatureScatter(seurat, feature1 = "nFeature_RNA", feature2 = "nCount_RNA") +
geom_vline(xintercept=7500) +
geom_hline(yintercept=5e+06)
FeatureScatter(seurat, feature1 = "nFeature_RNA", feature2 = "nCount_RNA") +
geom_vline(xintercept=7500) +
geom_hline(yintercept=35e+05)
# Remove cells with more than 7500 genes or 35e+05 total counts
seurat <- subset(seurat, subset = nFeature_RNA<7500 & nCount_RNA<35e+05)
dim(seurat)
# 9047 cells for Guo
# Normalize + log transfo + scale
seurat <- NormalizeData(seurat)
seurat <- ScaleData(seurat)
data <- GetAssayData(seurat)
rm(seurat)
# PCA
pca <- prcomp(data)
data_proj <- t(pca$rotation)
dim(data_proj)
# 9047 PCs x 9047 cells for Guo
write.table(data_proj, file=data_out)
lapply(x=c(0.1,0.5,1,1.5,2,4,10), function(x) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",x,"_pca2_monkow.rds"))
lapply(x=c(0.1,0.5,1,1.5,2,4,10), FUN=function(x) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",x,"_pca2_monkow.rds"))
lapply(X=c(0.1,0.5,1,1.5,2,4,10), FUN=function(x) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",x,"_pca2_monkow.rds"))
sapply(X=c(0.1,0.5,1,1.5,2,4,10), FUN=function(x) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",x,"_pca2_monkow.rds"))
all_paths=mapply(x=pval,y=pcval,
FUN=function(x,y) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",x,"_pca",y,"_minkow.rds"))
pval=c(0.1,0.5,1,1.5,2,4,10)
pcval=c(2,5,10,50,100,500,1000,5000,(cell_nb-1))
all_paths=mapply(x=pval,y=pcval,
FUN=function(x,y) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",x,"_pca",y,"_minkow.rds"))
l
pval=c(0.1,0.5,1,1.5,2,4,10)
pcval=c(2,5,10,50,100,500,1000,5000,(cell_nb-1))
cell_nb=9047
pcval=c(2,5,10,50,100,500,1000,5000,(cell_nb-1))
all_paths=mapply(x=pval,y=pcval,
FUN=function(x,y) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",x,"_pca",y,"_minkow.rds"))
all_paths=mapply(x=pval,
FUN=function(x,y) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",x,"_pca",y,"_minkow.rds"),y=pcval)
all_paths=sapply(x=pval,FUN=function(x,y) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",x,"_pca",y,"_minkow.rds"),
y=pcval)
all_paths=sapply(X=pval,FUN=function(x,y) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",x,"_pca",y,"_minkow.rds"),
y=pcval)
all_paths
all_paths=sapply(X=pcval,FUN=function(x,y) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",x,"_pca",y,"_minkow.rds"),
y=pval)
all_paths
all_paths=sapply(X=pcval,FUN=function(x,y) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",y,"_pca",x,"_minkow.rds"),
y=pval)
all_paths
h5_5 <- readRDS("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_5_pca5_minkow.rds")
all_paths=lapply(X=pcval,FUN=function(x,y) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",y,"_pca",x,"_minkow.rds"),
y=pval)
View(all_paths)
View(all_paths)
all_paths=sapply(X=pcval,FUN=function(x,y) paste0("/Users/elise/Desktop/Thèse/Calcsub/tmp_zela/ML/hubness/results_guo/kNN_occurence_",y,"_pca",x,"_minkow.rds"),
y=pval)
all_paths
# first option sceasy but didn't work
# second option https://satijalab.org/seurat/v3.1/conversion_vignette.html
loom <- as.loom(seurat, filename = "/Users/elise/Desktop/Thèse/ImmuCAN/azizi_1_2_3_4a.loom", verbose = FALSE)
library(Seurat)
library(tibble)
path_azizi = "/Users/elise/Desktop/Thèse/scRNAseq/Data_sc/Azizi_BC_2017/azizi_seurat.rds"
data_azizi <- readRDS(path_azizi)
genes <- rownames(data_azizi@assays$RNA@counts)
data_azizi <- data.frame(data_azizi@assays$RNA@counts)
rownames(data_azizi) <- genes
rownames(data_azizi) <- genes
rm(genes,path_azizi)
View(data_azizi)
data_azizi[1:10,1:5]
# Raw counts, 14875 x 47016
sum(data_azizi==0)/ncol(data_azizi)/nrow(data_azizi) #
# https://satijalab.org/seurat/v3.1/seurat_azizi3k_tutorial.html
# Seurat object
seurat_azizi <- CreateSeuratObject(data_azizi, min.cells = 5, min.features = 100)
rm(data_azizi)
# Look at percent mito etc
seurat_azizi$percent.mt <- PercentageFeatureSet(seurat_azizi, pattern = "^MT-")
VlnPlot(seurat_azizi, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
# Compute PCA and remove extreme cells
seurat_azizi <- NormalizeData(seurat_azizi)
seurat_azizi <- FindVariableFeatures(seurat_azizi)
VariableFeaturePlot(seurat_azizi)
seurat_azizi <- ScaleData(seurat_azizi)
seurat_azizi <- RunPCA(seurat_azizi, verbose = F)
DimPlot(seurat_azizi, reduction = "pca")
# Viz
seurat_azizi <- RunUMAP(seurat_azizi, dims = 1:50)
DimPlot(seurat_azizi, reduction = "umap")
# Clustering
seurat_azizi <- FindNeighbors(seurat_azizi, dims = 1:50)
seurat_azizi <- FindClusters(seurat_azizi, resolution = 0.5)
DimPlot(seurat_azizi, reduction = "umap")
seurat=seurat_azizi
saveRDS(seurat, file="/Users/elise/Desktop/Thèse/ImmuCAN/azizi_1_2_3_4.rds")
# first option sceasy but didn't work
# second option https://satijalab.org/seurat/v3.1/conversion_vignette.html
loom <- as.loom(seurat, filename = "/Users/elise/Desktop/Thèse/ImmuCAN/azizi_1_2_3_4.loom", verbose = FALSE)
devtools::install_github(repo = "mojaveazure/loomR")
# first option sceasy but didn't work
# second option https://satijalab.org/seurat/v3.1/conversion_vignette.html
library(loomR)
loom <- as.loom(seurat, filename = "/Users/elise/Desktop/Thèse/ImmuCAN/azizi_1_2_3_4.loom", verbose = FALSE)
loom <- as.loom(seurat, filename = "/Users/elise/Desktop/Thèse/ImmuCAN/azizi_1_2_3_4.loom", verbose = F)
# third option https://bioinformatics.stackexchange.com/questions/3943/convert-r-rna-seq-data-object-to-a-python-object/3944
library(reticulate)
Convert(from=seurat, to="anndata", filename="/Users/elise/Desktop/Thèse/ImmuCAN/azizi_1_2_3_4.h5ad")
loom <- as.loom(seurat, filename = "/Users/elise/Desktop/Thèse/ImmuCAN/azizi_1_2_3_4.loomF)
loom <- as.loom(seurat, filename = "/Users/elise/Desktop/Thèse/ImmuCAN/azizi_1_2_3_4.loom")
loom <- as.loom(seurat, filename = "/Users/elise/Desktop/Thèse/ImmuCAN/azizi_1_2_3_4.loom")
as.loom(seurat)
loom <- as.loom(seurat, filename = "/Users/elise/Desktop/Thèse/ImmuCAN/azizi_1_2_3_4.loom")
loom <- as.loom(seurat)
